<html>
  <head>
    <style>
    #container {
      height: 100%;
      width: 75%;
      float: left;
    }
    #map {
      height: 100%;
      width: 65%;
      float:left;
    }
    #rightContainer {
      float:right;
    }
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    </style>
    <title>Query</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script>
    function initMap() 
    {
      $('calander').hide();
      const myLatlng = { "lat": 44.237585669258515, "lng": -76.50587240389301};
      const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 14,
        center: myLatlng,
      });
      var drawingManager = new google.maps.drawing.DrawingManager({
        drawingControlOptions: {
          position: google.maps.ControlPosition.LEFT_BOTTOM,
          drawingModes: [
            google.maps.drawing.OverlayType.POLYGON,
            google.maps.drawing.OverlayType.RECTANGLE
          ]
        }
      });

      google.maps.event.addListener(drawingManager, 'rectanglecomplete', function (rectangle) {
        var rect = rectangle.getBounds();
        var coords = rect.toJSON();
        var coordinates = [
          {
            lng: coords.east,
            lat: coords.north
          },
          {
            lng: coords.west,
            lat: coords.south
          }
        ];
        document.getElementById("location").innerText = JSON.stringify(coordinates);
      });

      google.maps.event.addListener(drawingManager, 'polygoncomplete', function (polygon) {
        var polygonBounds = polygon.getPath();
        document.getElementById("location").innerText = JSON.stringify(polygonBounds.g)
      });

      drawingManager.setMap(map);
    }
    async function getVideos(){
      let locationBounds = JSON.parse(document.getElementById("location").innerText);
      let locationargs = [];
      locationBounds.forEach(element => 
        locationargs.push([element.lat, element.lng])
      );
      let args = {
        dateStart: document.getElementById("datelo").value ,
        dateEnd:document.getElementById("datehi").value,
        location:JSON.stringify(locationargs),
        model:'model1'
      };
      let formdata = "";
      for(var prop in args) formdata += (prop + "=" + args[prop] + "&" );

      const request = new Request("http://localhost:8000/api/getpred", {
            method: "POST",
            body: formdata,
            headers: {
              "Content-Type": 'application/x-www-form-urlencoded',
            },
        });
      return await fetch(request);
    }
    function submit(){
      getVideos().then((value)=>{ 
        value.json().then((data) => document.getElementById("response").innerHTML = JSON.stringify(data));
      });
    }
    window.initMap = initMap;
    </script>
  </head>
  <body>
    <div id="container">
    <div id="map"></div>
    <div id="rightContainer">
      <div id="calander">
        <input type="datetime-local" id="datelo">
        <input type="datetime-local" id="datehi">
        <button onclick="submit()">Submit</button>
      </div>
      <div id="response"></div>
      <div id="location" hidden="true"></div>
    </div>
  </div>
    <script>
      async function getgoogleapikey(){
        const response = await fetch("/usars/getgooglemapsapikey.php");
        const key = await response.json();
        return key;
      }
      getgoogleapikey().then((data) => {
        let GoogleScript = document.createElement("script");
        GoogleScript.setAttribute("src", "https://maps.googleapis.com/maps/api/js?key=" + data[0]['key'] + "&libraries=drawing&callback=initMap&v=weekly");
        document.body.appendChild(GoogleScript);
      });
    </script>
  </body>
</html>